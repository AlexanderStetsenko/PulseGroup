# ?? ??????????? ???????? ? ????????????? ?? Render

## ?? ???????? ???????

?? ????? ?????, ??? ??? ???????? ??????? ????? **0**:
```
config.ImportPreparation: 0
config.LandSeaDelivery: 0
config.Broker: 0
config.TransportFromPort: 0
config.CustomsPercent: 0.31  ?
config.ImportServices: 0
```

**???????:** ???? `pricing_config.json` ?? Render ????:
1. ?? ??????????
2. ?????? ??? ????? ???????????? ??????
3. ?? ????? ?????? ???? ???????

## ? ??? ???? ??????????

### 1. ???????? ??????????? ?????????????
**Program.cs:**
```csharp
?? Initializing configuration...
?? Config file path: /app/data/pricing_config.json
?? Stats file path: /app/data/bot_statistics.json

? Configuration loaded successfully
   ImportPreparation: $2000
   LandSeaDelivery: $3000
   Broker: $400
   TransportFromPort: $700
   CustomsPercent: 31%
   ImportServices: $1600
```

### 2. ?????????????? ???????? ??????????
**ConfigurationService.cs:**
```csharp
// ?????? ??????? /app/data ???? ?? ??????????
if (!Directory.Exists(dataDirectory))
{
    Console.WriteLine($"?? Creating data directory: {dataDirectory}");
    Directory.CreateDirectory(dataDirectory);
}
```

### 3. ????????? ??????????? ????????
```csharp
// ????????? ??? ???????? ?? ???????
if (config.ImportPreparation == 0 && config.LandSeaDelivery == 0)
{
    Console.WriteLine("?? Config loaded but all values are zero - using defaults");
    config = PricingConfig.GetDefault();
    SaveConfiguration(config);
}
```

### 4. ????????? ??????????? ???????? ? ???????
```csharp
?? Saving configuration to: /app/data/pricing_config.json
?? Serialized config (XXX chars):
{
  "ImportPreparation": 2000.0,
  "LandSeaDelivery": 3000.0,
  ...
}
? Config file saved successfully
   File size: XXX bytes
   Last modified: ...
```

### 5. ?????????? ?????????????? JSON
```csharp
var options = new JsonSerializerOptions
{
    PropertyNameCaseInsensitive = true,  // ?????????? ???????
    AllowTrailingCommas = true,          // ????????? ??????? ? ?????
    ReadCommentHandling = JsonCommentHandling.Skip  // ?????????? ???????????
};
```

## ?? ??? ?????????? ???????????

### ??? 1: ??????????? ?????????
```bash
git add .
git commit -m "Fix config loading with detailed logging and validation"
git push origin master
```

### ??? 2: Render ????????????? ???????????
Render ????????????? ????????? push ? ???????? ????? build.

### ??? 3: ????????? ???? ?? Render
1. ???????? https://dashboard.render.com
2. ???????? ??? ?????? `pulsegroup-bot`
3. ????????? ? **Logs**
4. ????? ??????:

**??????? ???? (??? ????????):**
```
?? PulseGroup Bot Starting...
?? Initializing configuration...
?? Data directory: /app/data
?? Config file: /app/data/pricing_config.json
?? Config file exists: true
? Configuration loaded successfully
   ImportPreparation: $2000
   LandSeaDelivery: $3000
   ...
```

**???? ?????? ?? ?????? (????????? ?????????????):**
```
?? Config file not found at: /app/data/pricing_config.json
?? Configuration file not found. Creating default configuration...
?? Creating default config...
?? Serialized config:
{
  "ImportPreparation": 2000.0,
  ...
}
? Default config created with values:
   ImportPreparation: 2000
   ...
```

### ??? 4: ????????? ??????
? Telegram:
```
/calculate
? ???????? ?????
? ???????: 2000
```

**????????? ?????????:**
```
?????? ???? 2 000$
???? ?? ????????
-?????????? ??????? 2 000$  ?
-???????? ???? + ???? 3 000$  ?
-?????? 400$  ?
-????????? ?? ????? 700$  ?
-??????? 1 116$ (31%)  ?
-?????? ?? ?????? 1 600$  ?

????????????????????
?????: 10 816$  ?
????????????????????
```

## ?? ??????????? ???????

### ????????: "Permission Denied"
```
? Error in SaveConfiguration:
   Message: Access to the path '/app/data/pricing_config.json' is denied
```

**???????:** ???????? ? Dockerfile:
```dockerfile
# ????? ENTRYPOINT
RUN mkdir -p /app/data && chmod 777 /app/data
```

### ????????: ???????? ??? ????? 0
```
?? Loaded values:
   ImportPreparation: 0
   ...
```

**????????? ???????:**
1. JSON ???? ?????????? ?? ??????
2. JSON ????? ?????? ?????? ? ??????? ??????? ?????
3. ????? ??????? ?? ????????? ?????? ????

**???????:**
1. ??????? ? Shell ?? Render:
```bash
# ? Dashboard Render ? Shell
cat /app/data/pricing_config.json
```

2. ???? ???? ?????? ??? ???????????? - ???????:
```bash
rm /app/data/pricing_config.json
# ????????????? ??? - ?? ??????? ?????
```

### ????????: Render Disk ?? ?????????
```
?? Data directory: /app
?? Config file: /app/pricing_config.json
```
(?????? ???? `/app/data/`)

**???????:** ????????? `render.yaml`:
```yaml
disk:
  name: bot-data
  mountPath: /app/data  # ? ?????? ???? ???
  sizeGB: 1
```

## ?? ??? ?????? ????? ????? ? ?????

### ??? ?????? ????:
```
?? PulseGroup Bot Starting...
?? Version: 2.2.0
?? HTTP Server listening on port: 8080
?? Bot Token: 8512569534...

?? Testing connection to Telegram API...
Bot connected successfully!
Bot ID: 8512569534
Bot Name: PulseGroup
Bot Username: @YourBotName

? Bot connection successful!

?? Initializing configuration...
?? Data directory: /app/data
?? Config file: /app/data/pricing_config.json
?? Config file exists: true

?? Loading config from: /app/data/pricing_config.json
?? Config file content (XXX chars): {"ImportPreparation":2000.0,...
? Configuration loaded from pricing_config.json
?? Loaded values:
   ImportPreparation: 2000
   LandSeaDelivery: 3000
   Broker: 400
   TransportFromPort: 700
   CustomsPercent: 0.31
   ImportServices: 1600

? Configuration loaded successfully
   ImportPreparation: $2000
   LandSeaDelivery: $3000
   Broker: $400
   TransportFromPort: $700
   CustomsPercent: 31%
   ImportServices: $1600

? All handlers initialized

? Listening for messages...
Bot is running. Press Ctrl+C to stop.
```

### ??? ???????:
```
????????????????????????????????????????
?? UPDATE RECEIVED: Type = Message
? Time: 10:33:25
?? From: @username (ID: 123456789)
?? Message: 2000
????????????????????????????????????????

?? Calculation step for chatId: 123456789
?? DEBUG ChinaCalculator.GetBreakdown:
   carPrice: 2000
   config.ImportPreparation: 2000  ?
   config.LandSeaDelivery: 3000  ?
   config.Broker: 400  ?
   config.TransportFromPort: 700  ?
   config.CustomsPercent: 0.31  ?
   config.ImportServices: 1600  ?
   calculated customs: 1116
   total: 10816  ?

? Update processed successfully
```

## ?? ????

????? ????????????? ???????????:

? ?????? ????? ????????????? ??????????? ???? ?? ??????????
? ????????? ???? ??????? ?????? ??? ????????
? ????????? ???????? ??? ???????? ?? ???????
? ??????? ????? ???????? ? ??????????? ??????
? ????? ??????????????? ????? ????????

**?????????? ????????? ? ????????? ???? ?? Render!** ??
