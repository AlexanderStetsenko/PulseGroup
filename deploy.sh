#!/bin/bash

# PulseGroup Bot - Quick Deploy Script

echo "?? PulseGroup Bot Deployment"
echo "=============================="
echo ""

# Check if Docker is installed
if ! command -v docker &> /dev/null; then
    echo "? Docker ?? ??????????!"
    echo "?????????? Docker: https://docs.docker.com/get-docker/"
    exit 1
fi

# Check if Docker Compose is installed
if ! command -v docker-compose &> /dev/null; then
    echo "? Docker Compose ?? ??????????!"
    echo "?????????? Docker Compose: https://docs.docker.com/compose/install/"
    exit 1
fi

echo "? Docker ??????????"
echo "? Docker Compose ??????????"
echo ""

# Create data directory if it doesn't exist
if [ ! -d "data" ]; then
    echo "?? ?????? ?????????? ??? ??????..."
    mkdir -p data
    chmod 755 data
    echo "? ?????????? data ???????"
else
    echo "? ?????????? data ??? ??????????"
fi
echo ""

# Ask for action
echo "???????? ????????:"
echo "1) ????????? ????"
echo "2) ?????????? ????"
echo "3) ????????????? ????"
echo "4) ???????? ????"
echo "5) ??????????? ? ?????????"
echo "6) ?????????? ? ??????? ?????????"
echo ""
read -p "??????? ????? (1-6): " choice

case $choice in
    1)
        echo ""
        echo "?? ???????? ????..."
        docker-compose up -d
        echo ""
        echo "? ??? ???????!"
        echo "??? ????????? ?????: docker-compose logs -f"
        ;;
    2)
        echo ""
        echo "?? ???????????? ????..."
        docker-compose down
        echo "? ??? ??????????!"
        ;;
    3)
        echo ""
        echo "?? ???????????? ????..."
        docker-compose restart
        echo "? ??? ???????????!"
        ;;
    4)
        echo ""
        echo "?? ???? ???? (Ctrl+C ??? ??????):"
        echo ""
        docker-compose logs -f
        ;;
    5)
        echo ""
        echo "?? ??????????? ?????..."
        docker-compose build --no-cache
        echo ""
        echo "?? ???????? ????..."
        docker-compose up -d
        echo ""
        echo "? ??? ?????????? ? ???????!"
        ;;
    6)
        echo ""
        echo "??? ???????????? ? ?????? ?????????..."
        docker-compose down
        docker rmi pulsegroup-pulsegroup-bot 2>/dev/null
        echo "? ????????? ??????!"
        echo "?? ?????? ? ?????????? data ?????????"
        ;;
    *)
        echo ""
        echo "? ???????? ?????!"
        exit 1
        ;;
esac

echo ""
