# ?? ??????????? ?? ??????? Telegram Bot

## ? ?????? ?????? ?????????? Telegram Bot?

Telegram ???? ???????? ??-??????????:
1. **??? ??????? UI** - ?? ???????????????? ????? Telegram
2. **??????????? ?????** - ????????? ???????? ?? ???????? Telegram
3. **Long Polling** - ??? ????????? ?????????? ??????: "???? ????? ??????????"

## ?? ??? ??????? ???????

### **?????? 1: Visual Studio Debugger (??????)**

#### ??? 1: ????????? ???????
```
1. ???????? ?????? ? Visual Studio 2022
2. ?????????? ????? ???????? (breakpoints):
   - Program.cs: ?????? ~45 (??? ?????????? ???)
   - UpdateHandler.cs: ????? HandleUpdateAsync
   - CalculationHandler.cs: ?????? ?????????
```

#### ??? 2: ?????? ???????
```
??????? F5 ??? ???????? "Debug > Start Debugging"
```

#### ??? 3: ?????????????? ? ?????
```
1. ???????? Telegram
2. ??????? ?????? ????
3. ????????? ??????? /start
4. Visual Studio ??????????? ?? breakpoint!
```

#### ??? ????????:
- ? **Variables** - ???????? ??????????
- ? **Call Stack** - ???? ??????????
- ? **Watch** - ???????? ?????????? ??? ??????????
- ? **Immediate Window** - ?????????? ???? ?? ????

---

### **?????? 2: ??????????? ??????????? (?????????)**

? ??????? ????????? ???????????. ?????? ??? ??????? ?? ???????:

```
?? PulseGroup Bot Starting...
?? Version: 2.2.0
?? HTTP Server listening on port: 8080
?? Bot Token: 8512569534...

?? Testing connection to Telegram API...
Bot connected successfully!
Bot ID: 8512569534
Bot Name: PulseGroup
Bot Username: @YourBotUsername

? Bot connection successful!

????????????????????????????????????????
?? UPDATE RECEIVED: Type = Message
? Time: 10:33:25
?? From: @username (ID: 123456789)
?? Message: /start
????????????????????????????????????????

?? Command: /start
? Update processed successfully
```

#### ??? ????????????:
```bash
# ????????? ???
dotnet run

# ???????? Telegram ? ????????? ?????????
# ???????? ??????? - ??? ????? ??? ??????????!
```

---

### **?????? 3: ????????? ??????? ? VS Code**

#### launch.json
```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": ".NET Core Launch (console)",
            "type": "coreclr",
            "request": "launch",
            "preLaunchTask": "build",
            "program": "${workspaceFolder}/PulseGroup/bin/Debug/net10.0/PulseGroup.dll",
            "args": [],
            "cwd": "${workspaceFolder}/PulseGroup",
            "console": "integratedTerminal",
            "stopAtEntry": false
        }
    ]
}
```

---

## ?? ?????? ???????? ? ???????

### ???????? 1: "??? ?? ???????? ?????????"

**?????????:**
```csharp
// ? Program.cs ?????????, ??? ??? ????????:
Console.WriteLine("? Listening for messages...");
Console.WriteLine($"Bot is running. Press Ctrl+C to stop.");
```

**???????:**
1. ? ?????????, ??? bot token ??????????
2. ? ????????? ????????-??????????
3. ? ?????????, ??? ?????? ????????? ???? ?? ???????
4. ? ?????????? ????? VPN (???? Telegram ????????????)

### ???????? 2: "Bot Token Invalid"

**???????:**
- Token ?????????? ??????????? (???????, ???????? ?????)
- Token ????? ??? ??? ???????
- Token ?? ??????? ????

**???????:**
```csharp
// BotConfig.cs
public const string BotToken = "8512569534:AAHkZo9PdhkMgKmAn-wIRm0Fcl0-bCiVhO0";
// ?? ?????: ??????? ????????, ???????, ?????????!
```

### ???????? 3: "Breakpoints ?? ???????????"

**???????:**
1. ??? ?? ????????????? ? Debug ??????
2. Breakpoint ? ???????????? ?????
3. ??? ??????? ?? ???????????

**???????:**
```bash
# ?????????, ??? ????????? ? Debug ??????
dotnet build -c Debug

# ????????? ? ??????????
dotnet run --configuration Debug
```

### ???????? 4: "Port Already in Use"

**??????:**
```
System.IO.IOException: Failed to bind to address http://[::]:8080
```

**???????:**
```bash
# Windows: ????? ??????? ?? ????? 8080
netstat -ano | findstr :8080
taskkill /PID <process_id> /F

# Linux/macOS:
lsof -i :8080
kill -9 <process_id>

# ??? ???????? ???? ? Program.cs:
var port = Environment.GetEnvironmentVariable("PORT") ?? "8081";
```

---

## ?? ?????????? ???? ? ???????? ???????

### ? ???????:
```
????????????????????????????????????????
?? UPDATE RECEIVED: Type = Message
? Time: 10:33:25
?? From: @username (ID: 123456789)
?? Message: /calculate
????????????????????????????????????????

?? Command: /calculate
? Update processed successfully
```

### ? Docker:
```bash
# ???????? ???? ? ???????? ???????
docker-compose logs -f pulsegroup-bot

# ????????? 100 ?????
docker-compose logs --tail=100 pulsegroup-bot
```

---

## ?? ????????? ??????? ?????????? ???????

### ??????? ???????:
```csharp
// CalculationHandler.cs
public async Task HandleCalculationStepAsync(...)
{
    Console.WriteLine($"?? DEBUG: Session step = {session.CurrentStep}");
    Console.WriteLine($"?? DEBUG: Input text = {message.Text}");
    
    if (decimal.TryParse(message.Text, out decimal price))
    {
        Console.WriteLine($"? DEBUG: Parsed price = {price}");
    }
    else
    {
        Console.WriteLine($"? DEBUG: Failed to parse price from '{message.Text}'");
    }
}
```

### ??????? ?????-??????:
```csharp
// AdminHandler.cs
public async Task HandleAuthenticationAsync(...)
{
    Console.WriteLine($"?? DEBUG: Password attempt = '{password}'");
    Console.WriteLine($"?? DEBUG: Expected = '{BotConfig.AdminPassword}'");
    Console.WriteLine($"?? DEBUG: Match = {password == BotConfig.AdminPassword}");
}
```

---

## ? ??????? ????

### ???? 1: ???????? ???????????
```bash
dotnet run
# ?????? ?????????:
# ? Bot connection successful!
# Bot Username: @YourBotUsername
```

### ???? 2: ???????? ????????? ?????????
```
1. ????????? ????
2. ????????? /start ? Telegram
3. ? ??????? ?????? ?????????:
   ?? UPDATE RECEIVED: Type = Message
   ?? Message: /start
```

### ???? 3: ???????? ???????
```
1. /calculate
2. ???????? ??????
3. ??????? ????: 2000
4. ???????? ??????? - ??? ????? ???? ???? ??????????
```

---

## ??? ??????????? ??? ???????

### 1. Telegram Bot API Log
???????? ??????????? ??? ????????:
```
https://api.telegram.org/bot<YOUR_TOKEN>/getUpdates
```

### 2. Postman/cURL
?????????? API ????????:
```bash
curl "https://api.telegram.org/bot<TOKEN>/getMe"
```

### 3. BotFather Commands
```
/setcommands - ?????????? ??????? ????
/deletebot - ??????? ???? (???? ????? ?????? ??????)
/token - ???????? ????? token
```

---

## ?? ???????? ??????

1. **?????? ?????????? ????** - 90% ??????? ????? ? ???????
2. **??????????? try-catch** - ???????????? ??? ??????????
3. **?????????? ?? ??????** - ??????? ???????????, ????? ???????, ????? ??????
4. **??????????? breakpoints** - ??? ??????? ??? Console.WriteLine
5. **?????????? encoding** - UTF-8 ?????????? ??? ???????? ??????

---

## ?? ???? ??? ????? ?? ????????

### ???????? ??????????? ???????? ???:
```csharp
var botClient = new TelegramBotClient("YOUR_TOKEN");
var me = await botClient.GetMe();
Console.WriteLine($"Bot: @{me.Username}");

botClient.StartReceiving(
    async (bot, update, ct) => {
        Console.WriteLine($"Got update: {update.Type}");
        if (update.Message?.Text != null)
            await bot.SendMessage(update.Message.Chat.Id, "????????!");
    },
    (bot, ex, ct) => {
        Console.WriteLine($"Error: {ex.Message}");
        return Task.CompletedTask;
    }
);

Console.ReadLine();
```

???? ???? ??? ?? ???????? - ???????? ?:
- ? Bot Token
- ? ????????-???????????
- ? Firewall/VPN

---

## ?? ??????!

?????? ? ??? ????:
- ? ????????? ???????????
- ? ?????????? ?? Visual Studio
- ? ??????? ?????? ???????
- ? ??????????? ??? ???????????

**????????? ???? ? ?????????? ??????? - ??? ?????? ??? ?????!**
